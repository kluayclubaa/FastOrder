(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[105],{4907:(e,s,t)=>{Promise.resolve().then(t.bind(t,6831))},6831:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>Q});var a=t(5155),r=t(2115),l=t(5868),n=t(5747),c=t(2713),i=t(4186),d=t(7434),o=t(3109),m=t(8564),x=t(9074),u=t(4783),h=t(3861),p=t(4416),g=t(7939),b=t(6308),j=t(381),y=t(4835),f=t(6474),N=t(5937),v=t(9420),w=t(8883),A=t(4631),k=t(4229),C=t(5695),S=t(5610),E=t(5317),F=t(6203),D=t(4616),_=t(7924),R=t(6932),O=t(1492),M=t(858);function U(){let[e,s]=(0,r.useState)([]),[t,l]=(0,r.useState)(!1),[n,c]=(0,r.useState)(null),[i,d]=(0,r.useState)(null),[o,m]=(0,r.useState)({show:!1,message:"",type:""}),[x,u]=(0,r.useState)(""),[h,g]=(0,r.useState)("all"),[b,j]=(0,r.useState)("name"),[y,f]=(0,r.useState)("asc"),[N,v]=(0,r.useState)([]),[w,U]=(0,r.useState)(null),[q,L]=(0,r.useState)(!1),[H,P]=(0,r.useState)({name:"",description:"",price:"",category:"",isAvailable:!0,isRecommended:!1,imageUrl:"",imageFile:null,options:[]}),G=(0,C.useRouter)(),[J,T]=(0,r.useState)({name:"",price:""});(0,r.useEffect)(()=>{let e=(0,F.hg)(S.j2,e=>{e?(d(e.uid),I(e.uid),z(e.uid)):G.push("/login")});return()=>e()},[G]);let I=async e=>{try{let s=await (0,E.GG)((0,E.P)((0,E.rJ)(S.db,"users"),(0,E._M)("__name__","==",e)));if(!s.empty){let e=s.docs[0].data();c({storeName:e.storeName||"",restaurantName:e.restaurantName||"",phone:e.phone||"",phoneNumber:e.phoneNumber||""})}}catch(e){console.error("Error fetching user profile:",e),et("ไม่สามารถโหลดข้อมูลโปรไฟล์ได้","error")}},z=e=>{try{l(!0);let t=(0,E.P)((0,E.rJ)(S.db,"users",e,"menu"),(0,E.My)(b,"asc"===y?"asc":"desc"));return(0,E.aQ)(t,e=>{let t=[],a=new Set;e.forEach(e=>{let s=e.data();t.push({id:e.id,...s}),s.category&&a.add(s.category)}),s(t),v(Array.from(a)),l(!1)},e=>{console.error("Error in menu real-time listener:",e),et("ไม่สามารถโหลดเมนูได้","error"),l(!1)})}catch(e){return console.error("Error setting up menu listener:",e),et("ไม่สามารถโหลดเมนูได้","error"),l(!1),()=>{}}},Q=async e=>{},Z=async e=>{if(!i||!e)return"";let s=(0,M.c7)(),t=e.name.split(".").pop(),a="menu_".concat(Date.now(),".").concat(t),r=(0,M.KR)(s,"users/".concat(i,"/menu/").concat(a));return await (0,M.D)(r,e),await (0,M.qk)(r)},K=async()=>{if(i){if(!H.name||!H.price)return void et("กรุณากรอกชื่อเมนูและราคา","error");try{l(!0);let e="";H.imageFile&&(e=await Z(H.imageFile));let s={name:H.name,description:H.description,price:Number.parseFloat(H.price),category:H.category,isAvailable:H.isAvailable,isRecommended:H.isRecommended,imageUrl:e,options:H.options,userId:i,storeName:(null==n?void 0:n.storeName)||"",restaurantName:(null==n?void 0:n.restaurantName)||"",createdAt:(0,E.O5)()};await (0,E.gS)((0,E.rJ)(S.db,"users",i,"menu"),s),V(),L(!1),et("เพิ่มเมนูสำเร็จ","success"),Q(i)}catch(e){console.error("Error adding menu item:",e),et("ไม่สามารถเพิ่มเมนูได้","error")}finally{l(!1)}}},B=async()=>{if(i&&w)try{l(!0);let e=H.imageUrl;if(H.imageFile){if(w.imageUrl&&w.imageUrl.includes("firebase"))try{let e=(0,M.c7)(),s=(0,M.KR)(e,w.imageUrl);await (0,M.XR)(s)}catch(e){console.error("Error deleting old image:",e)}e=await Z(H.imageFile)}let s={name:H.name,description:H.description,price:Number.parseFloat(H.price),category:H.category,isAvailable:H.isAvailable,isRecommended:H.isRecommended,imageUrl:e,options:H.options,updatedAt:(0,E.O5)()};await (0,E.mZ)((0,E.H9)(S.db,"users",i,"menu",w.id),s),V(),L(!1),et("อัปเดตเมนูสำเร็จ","success"),Q(i)}catch(e){console.error("Error updating menu item:",e),et("ไม่สามารถอัปเดตเมนูได้","error")}finally{l(!1)}},X=async e=>{if(i&&confirm("คุณต้องการลบเมนูนี้ใช่หรือไม่?"))try{l(!0),(0,E.H9)(S.db,"users",i,"menu",e);let s=await (0,E.GG)((0,E.P)((0,E.rJ)(S.db,"users",i,"menu"),(0,E._M)("__name__","==",e)));if(!s.empty){let e=s.docs[0].data();if(e.imageUrl&&e.imageUrl.includes("firebase"))try{let s=(0,M.c7)(),t=(0,M.KR)(s,e.imageUrl);await (0,M.XR)(t)}catch(e){console.error("Error deleting image:",e)}}await (0,E.kd)((0,E.H9)(S.db,"users",i,"menu",e)),et("ลบเมนูสำเร็จ","success"),Q(i)}catch(e){console.error("Error deleting menu item:",e),et("ไม่สามารถลบเมนูได้","error")}finally{l(!1)}},W=async(e,s)=>{if(i)try{await (0,E.mZ)((0,E.H9)(S.db,"users",i,"menu",e),{isAvailable:!s,updatedAt:(0,E.O5)()}),et("อัปเดตสถานะสำเร็จ","success"),Q(i)}catch(e){console.error("Error toggling availability:",e),et("ไม่สามารถอัปเดตสถานะได้","error")}},Y=async(e,s)=>{if(i)try{await (0,E.mZ)((0,E.H9)(S.db,"users",i,"menu",e),{isRecommended:!s,updatedAt:(0,E.O5)()}),et("อัปเดตสถานะสำเร็จ","success"),Q(i)}catch(e){console.error("Error toggling recommended status:",e),et("ไม่สามารถอัปเดตสถานะได้","error")}},V=()=>{P({name:"",description:"",price:"",category:"",isAvailable:!0,isRecommended:!1,imageUrl:"",imageFile:null,options:[]}),U(null)},$=e=>{U(e),P({name:e.name,description:e.description||"",price:e.price.toString(),category:e.category||"",isAvailable:e.isAvailable,isRecommended:e.isRecommended,imageUrl:e.imageUrl||"",imageFile:null,options:e.options||[]}),L(!0)},ee=()=>{V(),L(!0)},es=e=>{let{name:s,value:t,type:a}=e.target;if("checkbox"===a){let t=e.target;P({...H,[s]:t.checked})}else P({...H,[s]:t})},et=(e,s)=>{m({show:!0,message:e,type:s}),setTimeout(()=>{m({show:!1,message:"",type:""})},3e3)},ea=e.filter(e=>{let s=e.name.toLowerCase().includes(x.toLowerCase())||e.description.toLowerCase().includes(x.toLowerCase()),t="all"===h||e.category===h;return s&&t}),er=e=>{b===e?f("asc"===y?"desc":"asc"):(j(e),f("asc")),i&&Q(i)},el=e=>{P({...H,options:H.options.filter(s=>s.id!==e)})};return(0,a.jsxs)("div",{className:"container mx-auto px-4 py-6",children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-1",children:"จัดการเมนู"}),(0,a.jsx)("p",{className:"text-gray-600 text-sm",children:(null==n?void 0:n.storeName)?"ร้าน ".concat(n.storeName):"เพิ่มเมนูของร้านคุณ"})]}),(0,a.jsxs)("button",{onClick:ee,className:"mt-4 md:mt-0 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center",children:[(0,a.jsx)(D.A,{className:"h-4 w-4 mr-2"}),"เพิ่มเมนูใหม่"]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[(0,a.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,a.jsxs)("div",{className:"relative flex-1",children:[(0,a.jsx)(_.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,a.jsx)("input",{type:"text",placeholder:"ค้นหาเมนู...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:x,onChange:e=>u(e.target.value)})]}),(0,a.jsx)("div",{className:"flex gap-2",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(R.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,a.jsxs)("select",{className:"pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:h,onChange:e=>g(e.target.value),children:[(0,a.jsx)("option",{value:"all",children:"ทุกหมวดหมู่"}),N.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]})})]})}),t&&0===e.length?(0,a.jsx)("div",{className:"flex justify-center items-center p-8",children:(0,a.jsx)(A.A,{className:"h-8 w-8 text-blue-500 animate-spin"})}):0===e.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 px-4 text-center",children:[(0,a.jsx)("button",{onClick:ee,className:"bg-gray-100 p-4 rounded-full mb-4",children:(0,a.jsx)(D.A,{className:"h-8 w-8 text-gray-400"})}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"ยังไม่มีเมนู"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 max-w-md mb-6",children:"เพิ่มเมนูอาหารของร้านคุณเพื่อให้ลูกค้าสั่งได้"})]}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>er("name"),children:(0,a.jsxs)("div",{className:"flex items-center",children:["เมนู","name"===b&&(0,a.jsx)(O.A,{className:"ml-1 h-4 w-4 text-gray-400"})]})}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>er("price"),children:(0,a.jsxs)("div",{className:"flex items-center",children:["ราคา","price"===b&&(0,a.jsx)(O.A,{className:"ml-1 h-4 w-4 text-gray-400"})]})}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>er("category"),children:(0,a.jsxs)("div",{className:"flex items-center",children:["หมวดหมู่","category"===b&&(0,a.jsx)(O.A,{className:"ml-1 h-4 w-4 text-gray-400"})]})}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"สถานะ"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"แนะนำ"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"จัดการ"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:ea.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center",children:[e.imageUrl?(0,a.jsx)("img",{src:e.imageUrl||"/placeholder.svg",alt:e.name,className:"w-10 h-10 rounded-md object-cover mr-3"}):(0,a.jsx)("div",{className:"w-10 h-10 rounded-md bg-gray-200 flex items-center justify-center mr-3",children:(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"ไม่มีรูป"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),e.description&&(0,a.jsx)("div",{className:"text-xs text-gray-500 max-w-xs truncate",children:e.description})]})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"text-sm text-gray-900",children:["฿",e.price.toFixed(2)]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("div",{className:"text-sm text-gray-900",children:e.category||"-"})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("button",{onClick:()=>W(e.id,e.isAvailable),className:"px-2 py-1 rounded-full text-xs font-medium ".concat(e.isAvailable?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.isAvailable?"พร้อมขาย":"หมด"})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("button",{onClick:()=>Y(e.id,e.isRecommended),className:"px-2 py-1 rounded-full text-xs font-medium ".concat(e.isRecommended?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:e.isRecommended?"แนะนำ":"ไม่แนะนำ"})}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[(0,a.jsx)("button",{onClick:()=>$(e),className:"text-blue-600 hover:text-blue-900 mr-3",children:"แก้ไข"}),(0,a.jsx)("button",{onClick:()=>X(e.id),className:"text-red-600 hover:text-red-900",children:"ลบ"})]})]},e.id))})]})})]}),q&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,a.jsx)("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h3",{className:"text-xl font-bold",children:w?"แก้ไขเมนู":"เพิ่มเมนูใหม่"}),(0,a.jsx)("button",{className:"text-gray-500 hover:text-gray-700",onClick:()=>L(!1),children:(0,a.jsx)(p.A,{className:"h-5 w-5"})})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 gap-6",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ชื่อเมนู *"}),(0,a.jsx)("input",{type:"text",name:"name",value:H.name,onChange:es,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"ชื่อเมนู",required:!0})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ราคา (บาท) *"}),(0,a.jsx)("input",{type:"number",name:"price",value:H.price,onChange:es,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0.00",min:"0",step:"0.01",required:!0})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"หมวดหมู่"}),(0,a.jsxs)("select",{name:"category",value:H.category,onChange:es,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"",disabled:!0,children:"เลือกหมวดหมู่"}),(0,a.jsx)("option",{value:"อาหารจานเดียว",children:"อาหารจานเดียว"}),(0,a.jsx)("option",{value:"กับข้าว",children:"กับข้าว"}),(0,a.jsx)("option",{value:"เครื่องดื่ม",children:"เครื่องดื่ม"}),(0,a.jsx)("option",{value:"ของหวาน",children:"ของหวาน"}),(0,a.jsx)("option",{value:"อื่นๆ",children:"อื่นๆ"}),N.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"รายละเอียด"}),(0,a.jsx)("textarea",{name:"description",value:H.description,onChange:es,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"รายละเอียดเมนู",rows:3})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"รูปภาพเมนู"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsx)("div",{children:H.imageUrl?(0,a.jsxs)("div",{className:"relative w-full h-40 border rounded-md overflow-hidden",children:[(0,a.jsx)("img",{src:H.imageUrl||"/placeholder.svg",alt:"รูปภาพเมนู",className:"w-full h-full object-cover"}),(0,a.jsx)("button",{type:"button",onClick:()=>P({...H,imageUrl:"",imageFile:null}),className:"absolute top-2 right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600",children:(0,a.jsx)(p.A,{className:"h-4 w-4"})})]}):(0,a.jsxs)("label",{className:"cursor-pointer flex flex-col items-center justify-center w-full h-40 border-2 border-dashed border-gray-300 rounded-md hover:bg-gray-50",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[(0,a.jsx)("svg",{className:"w-10 h-10 text-gray-400 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),(0,a.jsx)("p",{className:"mb-2 text-sm text-gray-500",children:(0,a.jsx)("span",{className:"font-semibold",children:"อัพโหลดรูป"})}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"PNG, JPG หรือ GIF (สูงสุด 10MB)"})]}),(0,a.jsx)("input",{type:"file",accept:"image/*",className:"hidden",onChange:e=>{if(e.target.files&&e.target.files[0]){let s=e.target.files[0];P({...H,imageFile:s});let t=new FileReader;t.onload=e=>{var s;(null==(s=e.target)?void 0:s.result)&&P(s=>{var t;return{...s,imageUrl:null==(t=e.target)?void 0:t.result}})},t.readAsDataURL(s)}}})]})}),(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",id:"isAvailable",name:"isAvailable",checked:H.isAvailable,onChange:e=>P({...H,isAvailable:e.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,a.jsx)("label",{htmlFor:"isAvailable",className:"ml-2 text-sm text-gray-700",children:"พร้อมขาย"})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",id:"isRecommended",name:"isRecommended",checked:H.isRecommended,onChange:e=>P({...H,isRecommended:e.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,a.jsx)("label",{htmlFor:"isRecommended",className:"ml-2 text-sm text-gray-700",children:"แนะนำ"})]})]})})]})]})]})}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ตัวเลือกเพิ่มเติม"}),(0,a.jsxs)("div",{className:"space-y-2",children:[H.options.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-md",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:e.name}),(0,a.jsxs)("span",{className:"ml-2 text-gray-500",children:["+฿",e.price.toFixed(2)]})]}),(0,a.jsx)("button",{type:"button",onClick:()=>el(e.id),className:"text-red-500 hover:text-red-700",children:(0,a.jsx)(p.A,{className:"h-4 w-4"})})]},e.id)),(0,a.jsxs)("div",{className:"flex items-end gap-2 mt-2",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"block text-xs text-gray-500 mb-1",children:"ชื่อตัวเลือก"}),(0,a.jsx)("input",{type:"text",value:J.name,onChange:e=>T({...J,name:e.target.value}),placeholder:"เช่น เพิ่มหมู, เพิ่มวิปครีม",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{className:"w-24",children:[(0,a.jsx)("label",{className:"block text-xs text-gray-500 mb-1",children:"ราคา (฿)"}),(0,a.jsx)("input",{type:"number",value:J.price,onChange:e=>T({...J,price:e.target.value}),placeholder:"0",min:"0",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsx)("button",{type:"button",onClick:()=>{if(!J.name||!J.price)return void et("กรุณากรอกชื่อและราคาของตัวเลือก","error");P({...H,options:[...H.options,{id:Date.now().toString(),name:J.name,price:Number(J.price)}]}),T({name:"",price:""})},className:"px-3 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200",children:(0,a.jsx)(D.A,{className:"h-4 w-4"})})]})]})]}),(0,a.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,a.jsx)("button",{type:"button",className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700",onClick:()=>L(!1),children:"ยกเลิก"}),(0,a.jsx)("button",{type:"button",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center",onClick:w?B:K,disabled:t,children:t?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(A.A,{className:"h-4 w-4 mr-2 animate-spin"}),"กำลังบันทึก..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(k.A,{className:"h-4 w-4 mr-2"}),w?"อัปเดต":"บันทึก"]})})]})]})})}),o.show&&(0,a.jsx)("div",{className:"fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 ".concat("success"===o.type?"bg-green-500":"bg-red-500"," text-white"),children:o.message})]})}var q=t(3717),L=t(5196),H=t(3904),P=t(7712);function G(){let[e,s]=(0,r.useState)([]),[t,l]=(0,r.useState)(!1),[n,c]=(0,r.useState)("all"),[i,m]=(0,r.useState)(null),[x,u]=(0,r.useState)(""),[h,g]=(0,r.useState)({show:!1,message:"",type:""}),b=(0,C.useRouter)(),[j,y]=(0,r.useState)(null),[f,N]=(0,r.useState)([]);(0,r.useEffect)(()=>{let e=(0,F.hg)(S.j2,e=>{e?m(e.uid):b.push("/login")});return()=>e()},[b]),(0,r.useEffect)(()=>{if(i){let e=v(i);return()=>e&&e()}},[n,i]);let v=e=>{try{let t;l(!0);let a=new Date;return a.setHours(0,0,0,0),t="all"!==n?(0,E.P)((0,E.rJ)(S.db,"users",e,"orders"),(0,E._M)("status","==",n),(0,E._M)("createdAt",">=",a),(0,E.My)("createdAt","desc")):(0,E.P)((0,E.rJ)(S.db,"users",e,"orders"),(0,E._M)("createdAt",">=",a),(0,E.My)("createdAt","desc")),(0,E.aQ)(t,e=>{let t=[];e.forEach(e=>{let s=e.data();t.push({id:e.id,...s})}),s(t),l(!1)},e=>{console.error("Error in orders real-time listener:",e),k("ไม่สามารถโหลดข้อมูลออเดอร์ได้","error"),l(!1)})}catch(e){return console.error("Error setting up orders listener:",e),k("ไม่สามารถโหลดข้อมูลออเดอร์ได้","error"),l(!1),()=>{}}},w=async e=>{try{let s=(0,E.P)((0,E.rJ)(S.db,"users",e,"orders"),(0,E._M)("status","==","cooking"),(0,E.My)("queueNumber","asc")),t=await (0,E.GG)(s),a=(0,E.wP)(S.db);t.docs.forEach((e,s)=>{let t=e.ref;a.update(t,{queueNumber:s+1,updatedAt:(0,E.O5)()})}),await a.commit()}catch(e){console.error("Error updating queue numbers:",e)}},A=async(e,s)=>{if(i)try{l(!0);let t=(0,E.H9)(S.db,"users",i,"orders",e),a={status:s,updatedAt:(0,E.O5)()};if("cooking"===s){let e=(0,E.P)((0,E.rJ)(S.db,"users",i,"orders"),(0,E._M)("status","==","cooking"),(0,E.My)("updatedAt","asc"));a.queueNumber=(await (0,E.GG)(e)).size+1}await (0,E.mZ)(t,a),("served"===s||"cancelled"===s)&&await w(i),k('อัปเดตสถานะออเดอร์เป็น "'.concat(s,'" สำเร็จ'),"success")}catch(e){console.error("Error updating order status:",e),k("ไม่สามารถอัปเดตสถานะออเดอร์ได้","error")}finally{l(!1)}},k=(e,s)=>{g({show:!0,message:e,type:s}),setTimeout(()=>{g({show:!1,message:"",type:""})},3e3)},O=(e,s)=>{switch(e){case"pending":return(0,a.jsx)("span",{className:"bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full text-xs",children:"รอยืนยัน"});case"cooking":return(0,a.jsxs)("span",{className:"bg-orange-100 text-orange-800 px-2 py-1 rounded-full text-xs",children:["กำลังปรุง ",s&&"(คิว #".concat(s,")")]});case"served":return(0,a.jsx)("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs",children:"เสิร์ฟแล้ว"});case"completed":return(0,a.jsx)("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs",children:"เสร็จสิ้น"});case"cancelled":return(0,a.jsx)("span",{className:"bg-red-100 text-red-800 px-2 py-1 rounded-full text-xs",children:"ยกเลิก"});default:return(0,a.jsx)("span",{className:"bg-gray-100 text-gray-800 px-2 py-1 rounded-full text-xs",children:e})}},M=e=>{y(e),N([...e.items])},U=async()=>{if(i&&j)try{l(!0);let e=f.reduce((e,s)=>{let t=s.price*s.quantity,a=s.selectedOptions?s.selectedOptions.reduce((e,s)=>e+s.price,0)*s.quantity:0;return e+t+a},0),s=(0,E.H9)(S.db,"users",i,"orders",j.id);await (0,E.mZ)(s,{items:f,totalAmount:e,updatedAt:(0,E.O5)()}),y(null),k("อัปเดตออเดอร์สำเร็จ","success")}catch(e){console.error("Error updating order:",e),k("ไม่สามารถอัปเดตออเดอร์ได้","error")}finally{l(!1)}},G=(e,s)=>{if(s<1)return void J(e);N(t=>t.map((t,a)=>a===e?{...t,quantity:s}:t))},J=e=>{N(s=>s.filter((s,t)=>t!==e))},T=(e,s)=>{N(t=>t.map((t,a)=>a===e?{...t,specialInstructions:s}:t))},I=e=>{let s=[];switch("completed"!==e.status&&"cancelled"!==e.status&&s.push((0,a.jsxs)("button",{className:"px-3 py-1 bg-gray-600 text-white text-xs rounded-md flex items-center mr-2",onClick:()=>M(e),children:[(0,a.jsx)(q.A,{className:"h-3 w-3 mr-1"})," แก้ไข"]},"edit")),e.status){case"pending":s.push((0,a.jsxs)("button",{className:"px-3 py-1 bg-green-600 text-white text-xs rounded-md flex items-center",onClick:()=>A(e.id,"cooking"),children:[(0,a.jsx)(L.A,{className:"h-3 w-3 mr-1"})," ยืนยัน"]},"confirm"),(0,a.jsxs)("button",{className:"px-3 py-1 bg-red-600 text-white text-xs rounded-md flex items-center ml-2",onClick:()=>A(e.id,"cancelled"),children:[(0,a.jsx)(p.A,{className:"h-3 w-3 mr-1"})," ปฏิเสธ"]},"reject"));break;case"cooking":s.push((0,a.jsxs)("button",{className:"px-3 py-1 bg-blue-600 text-white text-xs rounded-md flex items-center",onClick:()=>A(e.id,"served"),children:[(0,a.jsx)(o.A,{className:"h-3 w-3 mr-1"})," เสิร์ฟแล้ว"]},"served"));break;case"served":s.push((0,a.jsxs)("button",{className:"px-3 py-1 bg-green-600 text-white text-xs rounded-md flex items-center",onClick:()=>A(e.id,"completed"),children:[(0,a.jsx)(L.A,{className:"h-3 w-3 mr-1"})," เสร็จสิ้น"]},"complete"))}return(0,a.jsx)("div",{className:"flex",children:s})},z=x?e.filter(e=>e.table.toLowerCase().includes(x.toLowerCase())||e.id.toLowerCase().includes(x.toLowerCase())):e;return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white p-4 md:p-6 rounded-xl shadow-sm border border-gray-100",children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6",children:[(0,a.jsx)("h2",{className:"text-lg md:text-xl font-bold mb-4 md:mb-0",children:"จัดการออเดอร์"}),(0,a.jsxs)("div",{className:"w-full md:w-auto flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-3",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(_.A,{className:"h-4 w-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,a.jsx)("input",{type:"text",placeholder:"ค้นหาโต๊ะ",className:"pl-9 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 w-full md:w-48",value:x,onChange:e=>u(e.target.value)})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(R.A,{className:"h-4 w-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,a.jsxs)("select",{className:"pl-9 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 w-full appearance-none",value:n,onChange:e=>c(e.target.value),children:[(0,a.jsx)("option",{value:"all",children:"ทั้งหมด"}),(0,a.jsx)("option",{value:"pending",children:"รอยืนยัน"}),(0,a.jsx)("option",{value:"cooking",children:"กำลังปรุง"}),(0,a.jsx)("option",{value:"served",children:"เสิร์ฟแล้ว"}),(0,a.jsx)("option",{value:"completed",children:"เสร็จสิ้น"}),(0,a.jsx)("option",{value:"cancelled",children:"ยกเลิก"})]})]}),(0,a.jsxs)("button",{className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 flex items-center justify-center",onClick:()=>{i&&v(i)},children:[(0,a.jsx)(H.A,{className:"h-4 w-4 mr-2"}),"รีเฟรช"]})]})]}),(0,a.jsx)("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg text-sm text-blue-800",children:(0,a.jsx)("p",{children:'หมายเหตุ: รายได้จะถูกคำนวณเฉพาะออเดอร์ที่มีสถานะ "เสร็จสิ้น" เท่านั้น ออเดอร์ที่ถูกปฏิเสธจะไม่ถูกนับเป็นรายได้'})}),t?(0,a.jsx)("div",{className:"flex justify-center items-center py-20",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"})}):z.length>0?(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"โต๊ะ"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"รายการ"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ราคารวม"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"เวลา"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"สถานะ"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"การดำเนินการ"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:z.map(e=>{var s,t,r,l,n;return(0,a.jsxs)("tr",{className:"cancelled"===e.status?"bg-gray-50":"",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"text-sm font-medium text-gray-900",children:["โต๊ะ ",e.table||"-"]})}),(0,a.jsxs)("td",{className:"px-6 py-4",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:[(null==(s=e.items)?void 0:s.length)||0," รายการ"]}),(0,a.jsxs)("div",{className:"text-xs text-gray-400 mt-1",children:[null==(t=e.items)?void 0:t.slice(0,2).map((s,t)=>{var r;return(0,a.jsxs)("span",{children:[s.name," x",s.quantity,s.selectedOptions&&s.selectedOptions.length>0&&" (".concat(s.selectedOptions.map(e=>e.name).join(", "),")"),s.specialInstructions&&" (".concat(s.specialInstructions,")"),t<Math.min(1,((null==(r=e.items)?void 0:r.length)||0)-1)?", ":""]},t)}),((null==(r=e.items)?void 0:r.length)||0)>2&&" และอื่นๆ อีก ".concat(e.items.length-2," รายการ")]})]}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,a.jsxs)("div",{className:"text-sm ".concat("cancelled"===e.status?"text-gray-500 line-through":"text-gray-900"),children:["฿",(null==(l=e.totalAmount)?void 0:l.toFixed(2))||"0"]}),"cancelled"===e.status&&(0,a.jsx)("div",{className:"text-xs text-red-500 mt-1",children:"ไม่นับเป็นรายได้"})]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("div",{className:"text-sm text-gray-500",children:(null==(n=e.createdAt)?void 0:n.toDate)?new Date(e.createdAt.toDate()).toLocaleTimeString("th-TH",{hour:"2-digit",minute:"2-digit"}):"-"})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:O(e.status,e.queueNumber)}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:I(e)})]},e.id)})})]})}):(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 px-4 text-center",children:[(0,a.jsx)("div",{className:"bg-gray-100 p-4 rounded-full mb-4",children:(0,a.jsx)(d.A,{className:"h-8 w-8 text-gray-400"})}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"ยังไม่มีออเดอร์"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 max-w-md mb-6",children:"ออเดอร์ใหม่จะปรากฏที่นี่เมื่อลูกค้าสั่งอาหาร"})]})]}),j&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-gray-200 flex items-center",children:[(0,a.jsxs)("h2",{className:"text-lg font-bold",children:["แก้ไขออเดอร์ #",j.id.slice(-6).toUpperCase()]}),(0,a.jsx)("button",{onClick:()=>y(null),className:"ml-auto p-1 rounded-full hover:bg-gray-100",children:(0,a.jsx)(p.A,{className:"h-5 w-5 text-gray-500"})})]}),(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsx)("h3",{className:"font-medium",children:"รายการอาหาร"}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["โต๊ะ ",j.table]})]}),(0,a.jsx)("div",{className:"space-y-3",children:f.map((e,s)=>(0,a.jsxs)("div",{className:"border border-gray-200 rounded-md p-3",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"font-medium",children:[e.name,e.selectedOptions&&e.selectedOptions.length>0&&(0,a.jsxs)("span",{className:"font-normal text-sm text-gray-600 ml-1",children:["(",e.selectedOptions.map(e=>e.name).join(", "),")"]})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["฿",e.price.toFixed(2),e.selectedOptions&&e.selectedOptions.length>0&&(0,a.jsxs)("span",{className:"ml-2",children:["+ ฿",e.selectedOptions.reduce((e,s)=>e+s.price,0).toFixed(2)]})]}),e.specialInstructions&&(0,a.jsxs)("div",{className:"text-sm italic text-gray-600 mt-1",children:['"',e.specialInstructions,'"']})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("button",{onClick:()=>G(s,e.quantity-1),className:"p-1 rounded-full bg-gray-100",children:(0,a.jsx)(P.A,{className:"h-4 w-4 text-gray-600"})}),(0,a.jsx)("span",{className:"mx-2 w-6 text-center",children:e.quantity}),(0,a.jsx)("button",{onClick:()=>G(s,e.quantity+1),className:"p-1 rounded-full bg-gray-100",children:(0,a.jsx)(D.A,{className:"h-4 w-4 text-gray-600"})}),(0,a.jsx)("button",{onClick:()=>J(s),className:"ml-2 p-1 rounded-full bg-red-100 text-red-600",children:(0,a.jsx)(p.A,{className:"h-4 w-4"})})]})]}),(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)("textarea",{placeholder:"คำแนะนำพิเศษ เช่น ไม่ใส่ผัก",className:"w-full p-2 text-sm border border-gray-200 rounded-md",rows:2,value:e.specialInstructions||"",onChange:e=>T(s,e.target.value)})})]},s))}),0===f.length&&(0,a.jsx)("div",{className:"text-center py-4 text-gray-500",children:"ไม่มีรายการอาหาร กรุณาเพิ่มรายการอาหาร"})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center font-medium mb-4",children:[(0,a.jsx)("div",{children:"ยอดรวม"}),(0,a.jsxs)("div",{children:["฿",f.reduce((e,s)=>e+s.price*s.quantity+(s.selectedOptions?s.selectedOptions.reduce((e,s)=>e+s.price,0)*s.quantity:0),0).toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,a.jsx)("button",{onClick:()=>y(null),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700",children:"ยกเลิก"}),(0,a.jsx)("button",{onClick:U,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",disabled:t||0===f.length,children:t?(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2"}),"กำลังบันทึก..."]}):"บันทึกการเปลี่ยนแปลง"})]})]})]})}),h.show&&(0,a.jsx)("div",{className:"fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 ".concat("success"===h.type?"bg-green-500":"bg-red-500"," text-white"),children:h.message})]})}var J=t(2583),T=t(1788),I=t(1304);function z(){let[e,s]=(0,r.useState)([]),[t,n]=(0,r.useState)([]),[c,i]=(0,r.useState)(!1),[o,m]=(0,r.useState)(null),[u,h]=(0,r.useState)(""),[p,g]=(0,r.useState)("today"),[j,y]=(0,r.useState)({show:!1,message:"",type:""}),[f,N]=(0,r.useState)(null),v=(0,C.useRouter)();(0,r.useEffect)(()=>{let e=(0,F.hg)(S.j2,e=>{e?(m(e.uid),w(e.uid)):v.push("/login")});return()=>e()},[v]),(0,r.useEffect)(()=>{if(o){let e=A(o);return()=>e&&e()}},[o,p]);let w=async e=>{try{let s=await (0,E.GG)((0,E.P)((0,E.rJ)(S.db,"users"),(0,E._M)("__name__","==",e)));s.empty||N(s.docs[0].data())}catch(e){console.error("Error fetching restaurant info:",e)}},A=e=>{try{i(!0);let t=new Date,a=new Date;switch(p){case"today":t.setHours(0,0,0,0),a.setHours(23,59,59,999);break;case"week":t.setDate(t.getDate()-7),t.setHours(0,0,0,0),a.setHours(23,59,59,999);break;case"month":t.setDate(1),t.setHours(0,0,0,0),(a=new Date(t.getFullYear(),t.getMonth()+1,0)).setHours(23,59,59,999);break;case"all":t=new Date(2020,0,1),a.setHours(23,59,59,999)}let r=(0,E.P)((0,E.rJ)(S.db,"users",e,"orders"),(0,E._M)("status","==","completed"),(0,E._M)("createdAt",">=",t),(0,E._M)("createdAt","<=",a),(0,E.My)("createdAt","desc"));return(0,E.aQ)(r,e=>{let t=[];e.forEach(e=>{let s=e.data();t.push({id:e.id,...s})}),s(t),i(!1)},e=>{console.error("Error in orders real-time listener:",e),O("ไม่สามารถโหลดข้อมูลบิลได้","error"),i(!1)})}catch(e){return console.error("Error setting up orders listener:",e),O("ไม่สามารถโหลดข้อมูลบิลได้","error"),i(!1),()=>{}}};(0,r.useEffect)(()=>{u?n(e.filter(e=>e.table.toLowerCase().includes(u.toLowerCase())||e.id.toLowerCase().includes(u.toLowerCase()))):n(e)},[e,u]);let k=e=>{var s,t,a;let r=(null==(s=e.createdAt)?void 0:s.toDate)?e.createdAt.toDate():new Date,l=(null==f?void 0:f.storeName)||(null==f?void 0:f.restaurantName)||"ร้านอาหาร",n=(null==f?void 0:f.phone)||(null==f?void 0:f.phoneNumber)||"",c="\n=================================\n".concat(l,"\n=================================\n").concat(n?"โทร: ".concat(n):"","\nวันที่: ").concat(r.toLocaleDateString("th-TH"),"\nเวลา: ").concat(r.toLocaleTimeString("th-TH"),"\nโต๊ะ: ").concat(e.table,"\nบิลเลขที่: #").concat(e.id.slice(-6).toUpperCase(),"\n=================================\n\nรายการอาหาร:\n"),i=0;return null==(t=e.items)||t.forEach((e,s)=>{var t;let a=(e.price+((null==(t=e.selectedOptions)?void 0:t.reduce((e,s)=>e+s.price,0))||0))*e.quantity;i+=e.quantity,c+="".concat(s+1,". ").concat(e.name," x").concat(e.quantity,"\n"),c+="   ราคา: ฿".concat(e.price.toFixed(2)),e.selectedOptions&&e.selectedOptions.length>0&&(c+="\n   ตัวเลือก: ".concat(e.selectedOptions.map(e=>"".concat(e.name," (+฿").concat(e.price,")")).join(", "))),e.specialInstructions&&(c+="\n   หมายเหตุ: ".concat(e.specialInstructions)),c+="\n   รวม: ฿".concat(a.toFixed(2),"\n\n")}),c+="=================================\nจำนวนรายการทั้งหมด: ".concat(i," ชิ้น\nยอดรวมทั้งสิ้น: ฿").concat((null==(a=e.totalAmount)?void 0:a.toFixed(2))||"0.00","\n=================================\n\nขอบคุณที่ใช้บริการ\nกรุณาเก็บใบเสร็จไว้เป็นหลักฐาน\n")},D=e=>{let s=new Blob([k(e)],{type:"text/plain;charset=utf-8"}),t=URL.createObjectURL(s),a=document.createElement("a");a.href=t,a.download="bill-".concat(e.id.slice(-6),"-table").concat(e.table,".txt"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t),O("ดาวน์โหลดบิลสำเร็จ","success")},R=e=>{let s=k(e),t=window.open("","_blank");t&&(t.document.write("\n        <html>\n          <head>\n            <title>บิล #".concat(e.id.slice(-6).toUpperCase(),"</title>\n            <style>\n              body { font-family: 'Courier New', monospace; white-space: pre-line; margin: 20px; }\n              @media print { body { margin: 0; } }\n            </style>\n          </head>\n          <body>").concat(s,"</body>\n        </html>\n      ")),t.document.close(),t.print())},O=(e,s)=>{y({show:!0,message:e,type:s}),setTimeout(()=>{y({show:!1,message:"",type:""})},3e3)},M=t.reduce((e,s)=>e+(s.totalAmount||0),0),U=t.length;return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white p-4 md:p-6 rounded-xl shadow-sm border border-gray-100",children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6",children:[(0,a.jsx)("h2",{className:"text-lg md:text-xl font-bold mb-4 md:mb-0",children:"จัดการบิล"}),(0,a.jsxs)("div",{className:"w-full md:w-auto flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-3",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(_.A,{className:"h-4 w-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,a.jsx)("input",{type:"text",placeholder:"ค้นหาโต๊ะหรือเลขบิล",className:"pl-9 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 w-full md:w-48",value:u,onChange:e=>h(e.target.value)})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(x.A,{className:"h-4 w-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,a.jsxs)("select",{className:"pl-9 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 w-full appearance-none",value:p,onChange:e=>g(e.target.value),children:[(0,a.jsx)("option",{value:"today",children:"วันนี้"}),(0,a.jsx)("option",{value:"week",children:"7 วันที่ผ่านมา"}),(0,a.jsx)("option",{value:"month",children:"เดือนนี้"}),(0,a.jsx)("option",{value:"all",children:"ทั้งหมด"})]})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[(0,a.jsx)("div",{className:"bg-green-50 p-4 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(l.A,{className:"h-8 w-8 text-green-600 mr-3"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-green-700",children:"รายได้รวม"}),(0,a.jsxs)("h3",{className:"text-xl font-bold text-green-900",children:["฿",M.toFixed(2)]})]})]})}),(0,a.jsx)("div",{className:"bg-blue-50 p-4 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(b.A,{className:"h-8 w-8 text-blue-600 mr-3"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-blue-700",children:"จำนวนบิล"}),(0,a.jsx)("h3",{className:"text-xl font-bold text-blue-900",children:U})]})]})}),(0,a.jsx)("div",{className:"bg-purple-50 p-4 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(d.A,{className:"h-8 w-8 text-purple-600 mr-3"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-purple-700",children:"มูลค่าเฉลี่ย"}),(0,a.jsxs)("h3",{className:"text-xl font-bold text-purple-900",children:["฿",U>0?(M/U).toFixed(2):"0.00"]})]})]})})]}),c?(0,a.jsx)("div",{className:"flex justify-center items-center py-20",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"})}):t.length>0?(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"เลขบิล"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"โต๊ะ"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"วันที่/เวลา"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"รายการ"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ยอดรวม"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"การดำเนินการ"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(e=>{var s,t,r,l,n,c;return(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"text-sm font-medium text-gray-900",children:["#",e.id.slice(-6).toUpperCase()]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"text-sm text-gray-900",children:["โต๊ะ ",e.table]})}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,a.jsx)("div",{className:"text-sm text-gray-900",children:(null==(s=e.createdAt)?void 0:s.toDate)?new Date(e.createdAt.toDate()).toLocaleDateString("th-TH",{day:"2-digit",month:"2-digit",year:"numeric"}):"-"}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:(null==(t=e.createdAt)?void 0:t.toDate)?new Date(e.createdAt.toDate()).toLocaleTimeString("th-TH",{hour:"2-digit",minute:"2-digit"}):"-"})]}),(0,a.jsxs)("td",{className:"px-6 py-4",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-900",children:[(null==(r=e.items)?void 0:r.length)||0," รายการ"]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:[null==(l=e.items)?void 0:l.slice(0,2).map((s,t)=>{var r;return(0,a.jsxs)("span",{children:[s.name," x",s.quantity,t<Math.min(1,((null==(r=e.items)?void 0:r.length)||0)-1)?", ":""]},t)}),((null==(n=e.items)?void 0:n.length)||0)>2&&" และอื่นๆ อีก ".concat(e.items.length-2," รายการ")]})]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"text-sm font-medium text-green-600",children:["฿",(null==(c=e.totalAmount)?void 0:c.toFixed(2))||"0"]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsxs)("button",{onClick:()=>D(e),className:"px-3 py-1 bg-blue-600 text-white text-xs rounded-md hover:bg-blue-700 flex items-center",children:[(0,a.jsx)(T.A,{className:"h-3 w-3 mr-1"}),"ดาวน์โหลด"]}),(0,a.jsxs)("button",{onClick:()=>R(e),className:"px-3 py-1 bg-gray-600 text-white text-xs rounded-md hover:bg-gray-700 flex items-center",children:[(0,a.jsx)(I.A,{className:"h-3 w-3 mr-1"}),"พิมพ์"]})]})})]},e.id)})})]})}):(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 px-4 text-center",children:[(0,a.jsx)("div",{className:"bg-gray-100 p-4 rounded-full mb-4",children:(0,a.jsx)(b.A,{className:"h-8 w-8 text-gray-400"})}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"ไม่มีบิลในช่วงเวลานี้"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 max-w-md mb-6",children:"บิลจะปรากฏที่นี่เมื่อมีออเดอร์ที่เสร็จสิ้นแล้ว"})]})]}),j.show&&(0,a.jsx)("div",{className:"fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 ".concat("success"===j.type?"bg-green-500":"bg-red-500"," text-white"),children:j.message})]})}function Q(){let[e,s]=(0,r.useState)("overview"),[t,D]=(0,r.useState)(!1),[_,R]=(0,r.useState)(!1),[O,M]=(0,r.useState)(!1),[q,L]=(0,r.useState)(null),[H,P]=(0,r.useState)({restaurantName:"",phoneNumber:"",email:"",storeName:"",phone:""}),[T,I]=(0,r.useState)({show:!1,message:"",type:""}),Q=(0,C.useRouter)(),[Z,K]=(0,r.useState)([]),[B,X]=(0,r.useState)([]),[W,Y]=(0,r.useState)(0),[V,$]=(0,r.useState)(0),[ee,es]=(0,r.useState)([]),[et,ea]=(0,r.useState)(!1),[er,el]=(0,r.useState)(!1),[en,ec]=(0,r.useState)(0),ei=(0,r.useRef)(null),[ed,eo]=(0,r.useState)([]);(0,r.useEffect)(()=>{let e=(0,F.hg)(S.j2,async e=>{if(e){let s=(0,E.H9)(S.db,"users",e.uid),t=await (0,E.x7)(s);if(!t.exists())return void Q.push("/setup");if(!t.data().isPaid)return void Q.push("/pricing");L(e),ex(e.uid),em(e.uid)}else Q.push("/login")});return()=>e()},[Q]);let em=e=>{let s=(0,E.P)((0,E.rJ)(S.db,"users",e,"menu"),(0,E._M)("isRecommended","==",!0),(0,E._M)("isAvailable","==",!0)),t=(0,E.aQ)(s,e=>{let s=[];e.forEach(e=>{s.push({id:e.id,...e.data()})}),K(s)},e=>{console.error("Error in menu real-time listener:",e)}),a=new Date;a.setHours(0,0,0,0);let r=(0,E.P)((0,E.rJ)(S.db,"users",e,"orders"),(0,E._M)("status","==","pending")),l=(0,E.aQ)(r,e=>{let s=[];e.forEach(e=>{s.push({id:e.id,...e.data()})}),X(s)},e=>{console.error("Error in orders real-time listener:",e)}),n=(0,E.P)((0,E.rJ)(S.db,"users",e,"orders"),(0,E._M)("createdAt",">=",a),(0,E._M)("status","==","completed")),c=(0,E.aQ)(n,e=>{let s=0,t=0;e.forEach(e=>{let a=e.data();s+=a.totalAmount||0,t++}),Y(s),$(t)},e=>{console.error("Error in revenue real-time listener:",e)}),i=async()=>{try{let s=new Date;s.setDate(s.getDate()-7);let t=(0,E.P)((0,E.rJ)(S.db,"users",e,"orders"),(0,E._M)("status","==","completed"),(0,E._M)("createdAt",">=",s),(0,E.My)("createdAt","asc")),a=(await (0,E.GG)(t)).docs.reduce((e,s)=>{var t;let a=s.data(),r=(null==(t=a.createdAt)?void 0:t.toDate)?new Date(a.createdAt.toDate()).toISOString().split("T")[0]:new Date().toISOString().split("T")[0];return e[r]||(e[r]=0),e[r]+=a.totalAmount||0,e},{}),r=Object.entries(a).map(e=>{let[s,t]=e;return{date:s,amount:t}});es(r)}catch(e){console.error("Error fetching weekly revenue:",e)}},d=async()=>{try{let s=new Date;s.setDate(s.getDate()-7);let t=(0,E.P)((0,E.rJ)(S.db,"users",e,"orders"),(0,E._M)("status","==","completed"),(0,E._M)("createdAt",">=",s)),a=await (0,E.GG)(t),r={};a.forEach(e=>{let s=e.data();s.items&&s.items.forEach(e=>{r[e.id]||(r[e.id]={name:e.name,count:0,revenue:0}),r[e.id].count+=e.quantity,r[e.id].revenue+=e.price*e.quantity,e.selectedOptions&&e.selectedOptions.forEach(s=>{r[e.id].revenue+=s.price*e.quantity})})});let l=Object.entries(r).map(e=>{let[s,t]=e;return{id:s,...t}}).sort((e,s)=>s.count-e.count).slice(0,5);eo(l)}catch(e){console.error("Error fetching popular menu items:",e)}};i(),d();let o=setInterval(()=>{i(),d()},36e5);return()=>{t(),l(),c(),clearInterval(o)}},ex=async e=>{try{M(!0);let s=(0,E.H9)(S.db,"users",e);return(0,E.aQ)(s,e=>{if(e.exists()){let s=e.data();P({restaurantName:s.restaurantName||"",phoneNumber:s.phoneNumber||"",email:s.email||"",storeName:s.storeName||"",phone:s.phone||""})}M(!1)},e=>{console.error("Error in profile real-time listener:",e),ep("ไม่สามารถโหลดข้อมูลโปรไฟล์ได้","error"),M(!1)})}catch(e){return console.error("Error fetching user profile:",e),ep("ไม่สามารถโหลดข้อมูลโปรไฟล์ได้","error"),M(!1),()=>{}}},eu=async()=>{if(q)try{M(!0);let e=(0,E.H9)(S.db,"users",q.uid);await (0,E.mZ)(e,{restaurantName:H.restaurantName,phoneNumber:H.phoneNumber,storeName:H.storeName,phone:H.phone,updatedAt:(0,E.O5)()}),ep("อัปเดตข้อมูลโปรไฟล์สำเร็จ","success"),R(!1)}catch(e){console.error("Error updating profile:",e),ep("ไม่สามารถอัปเดตข้อมูลโปรไฟล์ได้","error")}finally{M(!1)}},eh=async()=>{try{await (0,F.CI)(S.j2),Q.push("/login")}catch(e){console.error("Error signing out:",e)}},ep=(e,s)=>{I({show:!0,message:e,type:s}),setTimeout(()=>{I({show:!1,message:"",type:""})},3e3)},eg=e=>{let{name:s,value:t}=e.target;P(e=>({...e,[s]:t}))};(0,r.useEffect)(()=>(ei.current=new Audio("/notification.mp3"),()=>{ei.current&&(ei.current=null)}),[]),(0,r.useEffect)(()=>{B.length>en&&en>0&&(ei.current&&ei.current.play().catch(e=>console.error("Error playing notification sound:",e)),ep("มีออเดอร์ใหม่ ".concat(B.length-en," รายการ"),"success")),ec(B.length)},[B.length]),(0,r.useEffect)(()=>{let e=e=>{e.ctrlKey&&e.shiftKey&&"D"===e.key&&(e.preventDefault(),el(e=>!e))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]);let eb=(e,s,t)=>(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 px-4 text-center",children:[(0,a.jsx)("div",{className:"bg-gray-100 p-4 rounded-full mb-4",children:t}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:e}),(0,a.jsx)("p",{className:"text-sm text-gray-500 max-w-md mb-6",children:s})]}),ej=e=>{let{data:s}=e;if(!s||0===s.length)return null;let t=Math.max(...s.map(e=>e.amount));return(0,a.jsxs)("div",{className:"relative h-64 w-full mt-4",children:[(0,a.jsx)("div",{className:"flex items-end justify-between h-full w-full",children:s.map((e,s)=>{let r=e.amount/t*200||0,l=new Date(e.date).toLocaleDateString("th-TH",{day:"numeric",month:"short"});return(0,a.jsxs)("div",{className:"flex flex-col items-center",style:{flex:"1"},children:[(0,a.jsx)("div",{className:"bg-blue-500 rounded-t-sm w-12 transition-all duration-500 ease-in-out",style:{height:"".concat(r,"px")},title:"฿".concat(e.amount.toFixed(2))}),(0,a.jsx)("div",{className:"text-xs text-gray-600 mt-2 rotate-45 origin-left",children:l})]},s)})}),(0,a.jsxs)("div",{className:"absolute left-0 top-0 h-full flex flex-col justify-between text-xs text-gray-500",children:[(0,a.jsxs)("span",{children:["฿",t.toFixed(0)]}),(0,a.jsxs)("span",{children:["฿",(t/2).toFixed(0)]}),(0,a.jsx)("span",{children:"฿0"})]})]})};return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[(0,a.jsx)("header",{className:"bg-white border-b border-gray-200 sticky top-0 z-20 md:hidden",children:(0,a.jsxs)("div",{className:"flex items-center justify-between px-4 py-3",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("button",{className:"text-gray-500 hover:text-gray-700 mr-2",onClick:()=>D(!0),children:(0,a.jsx)(u.A,{className:"h-6 w-6"})}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"h-8 w-8 rounded-md bg-blue-600 flex items-center justify-center text-white mr-2",children:(0,a.jsx)(n.A,{className:"h-5 w-5"})}),(0,a.jsx)("h1",{className:"text-lg font-bold",children:H.storeName||"ร้านอาหาร"})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("button",{onClick:()=>s("orders"),className:"text-gray-500 hover:text-gray-700",children:(0,a.jsx)(h.A,{className:"h-6 w-6"})}),B.length>0&&(0,a.jsx)("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs font-medium px-1.5 py-0.5 rounded-full",children:B.length})]}),(0,a.jsx)("button",{onClick:()=>R(!0),children:(0,a.jsx)("img",{src:"/placeholder.svg?height=32&width=32",alt:"Profile",className:"h-8 w-8 rounded-full object-cover"})})]})]})}),t&&(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 z-20 md:hidden",onClick:()=>D(!1)}),(0,a.jsxs)("div",{className:"bg-white border-r border-gray-200 w-64 fixed inset-y-0 left-0 z-30 transition-transform duration-300 ease-in-out transform ".concat(t?"translate-x-0":"-translate-x-full"," md:translate-x-0"),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"h-8 w-8 rounded-md bg-blue-600 flex items-center justify-center text-white mr-2",children:(0,a.jsx)(n.A,{className:"h-5 w-5"})}),(0,a.jsx)("h1",{className:"text-xl font-bold",children:H.storeName||"ร้านอาหาร"})]}),(0,a.jsx)("button",{className:"md:hidden text-gray-500 hover:text-gray-700",onClick:()=>D(!1),children:(0,a.jsx)(p.A,{className:"h-5 w-5"})})]}),(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("button",{className:"w-full flex items-center px-3 py-2 rounded-md ".concat("overview"===e?"bg-blue-50 text-blue-700":"text-gray-700 hover:bg-gray-100"),onClick:()=>{s("overview"),D(!1)},children:[(0,a.jsx)(c.A,{className:"h-5 w-5 mr-3"}),(0,a.jsx)("span",{children:"ภาพรวม"})]}),(0,a.jsxs)("button",{className:"w-full flex items-center justify-between px-3 py-2 rounded-md ".concat("orders"===e?"bg-blue-50 text-blue-700":"text-gray-700 hover:bg-gray-100"),onClick:()=>{s("orders"),D(!1)},children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(d.A,{className:"h-5 w-5 mr-3"}),(0,a.jsx)("span",{children:"ออเดอร์"})]}),B.length>0&&(0,a.jsx)("span",{className:"bg-red-500 text-white text-xs font-medium px-2 py-0.5 rounded-full",children:B.length})]}),(0,a.jsxs)("button",{className:"w-full flex items-center px-3 py-2 rounded-md ".concat("menu"===e?"bg-blue-50 text-blue-700":"text-gray-700 hover:bg-gray-100"),onClick:()=>{s("menu"),D(!1)},children:[(0,a.jsx)(n.A,{className:"h-5 w-5 mr-3"}),(0,a.jsx)("span",{children:"เมนู"})]}),(0,a.jsxs)("button",{className:"w-full flex items-center px-3 py-2 rounded-md ".concat("qrcode"===e?"bg-blue-50 text-blue-700":"text-gray-700 hover:bg-gray-100"),onClick:()=>{s("qrcode"),D(!1)},children:[(0,a.jsx)(g.A,{className:"h-5 w-5 mr-3"}),(0,a.jsx)("span",{children:"QR Code"})]}),(0,a.jsxs)("button",{className:"w-full flex items-center px-3 py-2 rounded-md ".concat("revenue"===e?"bg-blue-50 text-blue-700":"text-gray-700 hover:bg-gray-100"),onClick:()=>{s("revenue"),D(!1)},children:[(0,a.jsx)(l.A,{className:"h-5 w-5 mr-3"}),(0,a.jsx)("span",{children:"รายได้"})]}),(0,a.jsxs)("button",{className:"w-full flex items-center px-3 py-2 rounded-md ".concat("bills"===e?"bg-blue-50 text-blue-700":"text-gray-700 hover:bg-gray-100"),onClick:()=>{s("bills"),D(!1)},children:[(0,a.jsx)(b.A,{className:"h-5 w-5 mr-3"}),(0,a.jsx)("span",{children:"บิล"})]})]}),(0,a.jsxs)("div",{className:"mt-8",children:[(0,a.jsx)("p",{className:"px-3 text-xs font-medium text-gray-400 uppercase mb-2",children:"บัญชี"}),(0,a.jsxs)("button",{className:"w-full flex items-center px-3 py-2 rounded-md text-gray-700 hover:bg-gray-100",onClick:()=>{R(!0),D(!1)},children:[(0,a.jsx)(j.A,{className:"h-5 w-5 mr-3"}),(0,a.jsx)("span",{children:"ตั้งค่าโปรไฟล์"})]}),(0,a.jsxs)("button",{className:"w-full flex items-center px-3 py-2 rounded-md text-gray-700 hover:bg-gray-100",onClick:eh,children:[(0,a.jsx)(y.A,{className:"h-5 w-5 mr-3"}),(0,a.jsx)("span",{children:"ออกจากระบบ"})]})]})]})]}),(0,a.jsxs)("div",{className:"flex-1 md:ml-64",children:[(0,a.jsx)("header",{className:"bg-white border-b border-gray-200 sticky top-0 z-10 hidden md:block",children:(0,a.jsxs)("div",{className:"flex items-center justify-between px-6 py-3",children:[(0,a.jsx)("h2",{className:"text-lg font-bold",children:(e=>{switch(e){case"overview":return"ภาพรวม";case"qrcode":return"สร้าง QR Code";case"orders":return"ออเดอร์";case"revenue":return"รายได้";case"menu":return"จัดการเมนู";case"bills":return"จัดการบิล";default:return""}})(e)}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("button",{onClick:()=>s("orders"),className:"text-gray-500 hover:text-gray-700",children:(0,a.jsx)(h.A,{className:"h-6 w-6"})}),B.length>0&&(0,a.jsx)("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs font-medium px-1.5 py-0.5 rounded-full",children:B.length})]}),(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsxs)("button",{className:"flex items-center space-x-2 focus:outline-none",onClick:()=>R(!0),children:[(0,a.jsxs)("div",{className:"hidden md:block text-left",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:H.storeName||"ร้านอาหารของคุณ"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:H.phone||H.phoneNumber||"เบอร์โทรศัพท์"})]}),(0,a.jsx)(f.A,{className:"h-4 w-4 text-gray-500"})]})})]})]})}),(0,a.jsxs)("main",{className:"p-4 md:p-6",children:[(()=>{switch(e){case"overview":return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6",children:[(0,a.jsx)("div",{className:"bg-white p-4 md:p-6 rounded-xl shadow-sm border border-gray-100",children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"รายได้วันนี้"}),(0,a.jsxs)("h3",{className:"text-xl md:text-2xl font-bold mt-1",children:["฿",W.toFixed(2)]})]}),(0,a.jsx)("div",{className:"p-2 bg-green-50 rounded-lg",children:(0,a.jsx)(l.A,{className:"h-5 w-5 md:h-6 md:w-6 text-green-500"})})]})}),(0,a.jsx)("div",{className:"bg-white p-4 md:p-6 rounded-xl shadow-sm border border-gray-100",children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"จำนวนออเดอร์ที่เสร็จสิ้น"}),(0,a.jsx)("h3",{className:"text-xl md:text-2xl font-bold mt-1",children:V})]}),(0,a.jsx)("div",{className:"p-2 bg-blue-50 rounded-lg",children:(0,a.jsx)(n.A,{className:"h-5 w-5 md:h-6 md:w-6 text-blue-500"})})]})}),(0,a.jsx)("div",{className:"bg-white p-4 md:p-6 rounded-xl shadow-sm border border-gray-100",children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"มูลค่าเฉลี่ยต่อออเดอร์"}),(0,a.jsxs)("h3",{className:"text-xl md:text-2xl font-bold mt-1",children:["฿",V>0?(W/V).toFixed(2):"0.00"]})]}),(0,a.jsx)("div",{className:"p-2 bg-purple-50 rounded-lg",children:(0,a.jsx)(c.A,{className:"h-5 w-5 md:h-6 md:w-6 text-purple-500"})})]})}),(0,a.jsx)("div",{className:"bg-white p-4 md:p-6 rounded-xl shadow-sm border border-gray-100",children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"ออเดอร์ที่รอยืนยัน"}),(0,a.jsx)("h3",{className:"text-xl md:text-2xl font-bold mt-1",children:B.length})]}),(0,a.jsx)("div",{className:"p-2 bg-amber-50 rounded-lg",children:(0,a.jsx)(i.A,{className:"h-5 w-5 md:h-6 md:w-6 text-amber-500"})})]})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"lg:col-span-2 bg-white p-4 md:p-6 rounded-xl shadow-sm border border-gray-100",children:[(0,a.jsx)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6",children:(0,a.jsx)("h3",{className:"font-bold mb-2 sm:mb-0",children:"รายได้"})}),ee.length>0?(0,a.jsx)(ej,{data:ee}):eb("ยังไม่มีข้อมูลรายได้","รายได้จะแสดงเมื่อมีออเดอร์ที่เสร็จสิ้นแล้วเท่านั้น",(0,a.jsx)(c.A,{className:"h-8 w-8 text-gray-400"}))]}),(0,a.jsxs)("div",{className:"bg-white p-4 md:p-6 rounded-xl shadow-sm border border-gray-100 h-[500px] overflow-y-auto",children:[(0,a.jsx)("h3",{className:"font-bold mb-4",children:"ออเดอร์ที่รอการยืนยัน"}),B.length>0?(0,a.jsx)("div",{className:"space-y-3",children:B.map(e=>{var t,r;return(0,a.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsxs)("span",{className:"font-medium",children:["โต๊ะ ",e.table||"-"]}),(0,a.jsx)("span",{className:"bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full text-xs",children:"รอยืนยัน"})]}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 mb-2",children:[(null==(t=e.items)?void 0:t.length)||0," รายการ \xb7 ฿",(null==(r=e.totalAmount)?void 0:r.toFixed(2))||"0"]}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)("button",{className:"px-3 py-1 bg-blue-600 text-white text-xs rounded-md",onClick:()=>s("orders"),children:"ดูรายละเอียด"})})]},e.id)})}):eb("ไม่มีออเดอร์ที่รอการยืนยัน","ออเดอร์ใหม่จะปรากฏที่นี่เมื่อลูกค้าสั่งอาหาร",(0,a.jsx)(d.A,{className:"h-8 w-8 text-gray-400"}))]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 h-[500px] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"bg-white p-4 md:p-6 rounded-xl shadow-sm border border-gray-100",children:[(0,a.jsx)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6",children:(0,a.jsx)("h3",{className:"font-bold mb-2 sm:mb-0",children:"เมนูยอดนิยม "})}),ed.length>0?(0,a.jsx)("div",{className:"space-y-3",children:ed.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-3",children:(0,a.jsxs)("span",{className:"text-blue-600 font-bold text-sm",children:["#",s+1]})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900",children:e.name}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["สั่ง ",e.count," ครั้ง"]})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("div",{className:"text-sm font-medium text-green-600",children:["฿",e.revenue.toFixed(2)]}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"รายได้"})]})]},e.id))}):eb("ยังไม่มีข้อมูลเมนูยอดนิยม","ข้อมูลจะแสดงเมื่อมีออเดอร์ที่เสร็จสิ้นแล้ว",(0,a.jsx)(o.A,{className:"h-8 w-8 text-gray-400"}))]}),(0,a.jsxs)("div",{className:"bg-white p-4 md:p-6 rounded-xl shadow-sm border border-gray-100 h-[500px] overflow-y-auto",children:[(0,a.jsx)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6",children:(0,a.jsx)("h3",{className:"font-bold mb-2 sm:mb-0",children:"เมนูแนะนำ"})}),Z.length>0?(0,a.jsx)("div",{className:"space-y-3",children:Z.slice(0,4).map(e=>{var s;return(0,a.jsxs)("div",{className:"flex items-center p-3 border border-gray-200 rounded-lg",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-gray-100 rounded-lg mr-3 overflow-hidden",children:e.imageUrl?(0,a.jsx)("img",{src:e.imageUrl||"/placeholder.svg",alt:e.name,className:"w-full h-full object-cover"}):(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,a.jsx)(n.A,{className:"h-6 w-6 text-gray-400"})})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900",children:e.name}),(0,a.jsxs)("div",{className:"flex justify-between items-center mt-1",children:[(0,a.jsxs)("span",{className:"text-blue-600 font-medium",children:["฿",null==(s=e.price)?void 0:s.toFixed(2)]}),(0,a.jsx)("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full",children:"แนะนำ"})]})]})]},e.id)})}):eb("ยังไม่มีเมนูแนะนำ","เพิ่มเมนูแนะนำเพื่อแสดงที่นี่",(0,a.jsx)(m.A,{className:"h-8 w-8 text-gray-400"}))]})]})]});case"qrcode":return(0,a.jsx)(J.A,{});case"orders":return(0,a.jsx)(G,{});case"revenue":return(0,a.jsx)("div",{className:"space-y-6",children:(0,a.jsxs)("div",{className:"bg-white p-4 md:p-6 rounded-xl shadow-sm border border-gray-100",children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-lg md:text-xl font-bold mb-4 md:mb-0",children:"สรุปรายได้"}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,a.jsx)("button",{className:"px-3 py-1.5 bg-blue-600 text-white text-xs md:text-sm rounded-md",children:"วันนี้"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"date",className:"pl-3 pr-10 py-1.5 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-xs md:text-sm"}),(0,a.jsx)(x.A,{className:"h-4 w-4 absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 md:gap-6 mb-8",children:[(0,a.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,a.jsx)("p",{className:"text-xs md:text-sm text-blue-700",children:"รายได้รวม"}),(0,a.jsxs)("h3",{className:"text-xl md:text-2xl font-bold text-blue-900 mt-1",children:["฿",W.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg",children:[(0,a.jsx)("p",{className:"text-xs md:text-sm text-green-700",children:"จำนวนออเดอร์"}),(0,a.jsx)("h3",{className:"text-xl md:text-2xl font-bold text-green-900 mt-1",children:V})]}),(0,a.jsxs)("div",{className:"bg-purple-50 p-4 rounded-lg",children:[(0,a.jsx)("p",{className:"text-xs md:text-sm text-purple-700",children:"มูลค่าเฉลี่ยต่อออเดอร์"}),(0,a.jsxs)("h3",{className:"text-xl md:text-2xl font-bold text-purple-900 mt-1",children:["฿",V>0?(W/V).toFixed(2):"0.00"]})]})]}),(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h3",{className:"font-bold mb-4",children:"รายได้ตามช่วงเวลา"}),ee.length>0?(0,a.jsx)(ej,{data:ee}):eb("ยังไม่มีข้อมูลรายได้","เริ่มรับออเดอร์เพื่อดูข้อมูลรายได้ตามช่วงเวลา",(0,a.jsx)(c.A,{className:"h-8 w-8 text-gray-400"}))]})]})});case"menu":return(0,a.jsx)(U,{});case"bills":return(0,a.jsx)(z,{});default:return(0,a.jsx)("div",{children:"เลือกเมนูเพื่อดูข้อมูล"})}})(),er&&!1]})]}),_&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,a.jsx)("div",{className:"bg-white rounded-lg max-w-md w-full max-h-[90vh] overflow-y-auto",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h3",{className:"text-xl font-bold",children:"ตั้งค่าโปรไฟล์"}),(0,a.jsx)("button",{className:"text-gray-500 hover:text-gray-700",onClick:()=>R(!1),children:(0,a.jsx)(p.A,{className:"h-5 w-5"})})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ชื่อร้านอาหาร"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(N.A,{className:"h-5 w-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,a.jsx)("input",{type:"text",name:"storeName",value:H.storeName,onChange:eg,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"ชื่อร้านอาหารของคุณ"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"เบอร์โทรศัพท์"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(v.A,{className:"h-5 w-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,a.jsx)("input",{type:"tel",name:"phone",value:H.phone,onChange:eg,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"เบอร์โทรศัพท์"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"อีเมล"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(w.A,{className:"h-5 w-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,a.jsx)("input",{type:"email",name:"email",value:H.email,disabled:!0,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md bg-gray-50 cursor-not-allowed"})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"ไม่สามารถเปลี่ยนอีเมลได้"})]})]}),(0,a.jsxs)("div",{className:"mt-8 flex justify-end space-x-3",children:[(0,a.jsx)("button",{className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700",onClick:()=>R(!1),children:"ยกเลิก"}),(0,a.jsx)("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center",onClick:eu,disabled:O,children:O?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(A.A,{className:"h-4 w-4 mr-2 animate-spin"}),"กำลังบันทึก..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(k.A,{className:"h-4 w-4 mr-2"}),"บันทึก"]})})]})]})})}),T.show&&(0,a.jsx)("div",{className:"fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 ".concat("success"===T.type?"bg-green-500":"bg-red-500"," text-white"),children:T.message})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[992,122,234,432,977,951,583,441,684,358],()=>s(4907)),_N_E=e.O()}]);