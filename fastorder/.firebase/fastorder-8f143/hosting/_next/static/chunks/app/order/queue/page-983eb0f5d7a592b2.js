(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{238:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});let l=(0,s(9946).A)("gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]])},646:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});let l=(0,s(9946).A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},1007:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});let l=(0,s(9946).A)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},4186:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});let l=(0,s(9946).A)("clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},4416:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});let l=(0,s(9946).A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},5610:(e,t,s)=>{"use strict";s.d(t,{H9:()=>n.H9,IG:()=>m,db:()=>d,j2:()=>o,x7:()=>n.x7});var l=s(3915),a=s(6203),n=s(5317),r=s(858),i=s(1427);let c=(0,l.Wp)({apiKey:"AIzaSyBdnWr8bkOF5oP2gSsjo9pXbrZbJO-QzDc",authDomain:"fastorder-8f143.firebaseapp.com",projectId:"fastorder-8f143",storageBucket:"fastorder-8f143.firebasestorage.app",messagingSenderId:"827965800193",appId:"1:827965800193:web:1d9ff91b5f6adb90bf6500",measurementId:"G-2LXXJM6W59"}),o=(0,a.xI)(c),d=(0,n.aU)(c);new a.HF;let m=(0,r.c7)(c);(0,i.Uz)(c)},5747:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});let l=(0,s(9946).A)("utensils",[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"j28e5"}]])},6308:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});let l=(0,s(9946).A)("receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]])},6474:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});let l=(0,s(9946).A)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]])},6652:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>v});var l=s(5155),a=s(2115),n=s(5695),r=s(4186),i=s(5747),c=s(646),o=s(4416),d=s(7550),m=s(1007),x=s(238);let u=(0,s(9946).A)("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);var h=s(6474),g=s(6308),p=s(5610),b=s(5317);let f=async()=>"Notification"in window&&"granted"===await Notification.requestPermission(),j=(e,t,s)=>{if("Notification"in window&&"granted"===Notification.permission){let l=new Notification(e,{body:t,icon:s||"/favicon.ico",badge:"/favicon.ico",tag:"queue-status",requireInteraction:!0});l.onclick=()=>{window.focus(),l.close()},setTimeout(()=>{l.close()},15e3)}},N=e=>{let{tableNumber:t}=e,[s,n]=(0,a.useState)([]),r=(e,t)=>{"Notification"in window&&("granted"===Notification.permission?new Notification(e,{body:t,icon:"/favicon.ico"}):"denied"!==Notification.permission&&Notification.requestPermission().then(s=>{"granted"===s&&new Notification(e,{body:t,icon:"/favicon.ico"})}))};return(0,a.useEffect)(()=>{let e=setInterval(()=>{let e=JSON.parse(localStorage.getItem("customer_notifications")||"[]"),s=e.filter(e=>e.table===t&&"staff_confirmed"===e.type&&Date.now()-e.timestamp<3e5);s.length>0&&(n(s),s.forEach(e=>{r("✅ พนักงานรับเรื่องแล้ว",e.message)}),setTimeout(()=>{let t=e.filter(e=>!s.some(t=>t.timestamp===e.timestamp));localStorage.setItem("customer_notifications",JSON.stringify(t)),n([])},5e3))},2e3);return()=>clearInterval(e)},[t]),(0,l.jsx)("div",{children:s.length>0&&(0,l.jsx)("div",{className:"fixed top-20 left-1/2 transform -translate-x-1/2 z-50 max-w-md w-full mx-4",children:s.map((e,t)=>(0,l.jsx)("div",{className:"bg-green-500 text-white p-4 rounded-lg shadow-lg mb-2 animate-bounce",children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("div",{className:"text-2xl mr-3",children:"✅"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"font-bold",children:"พนักงานรับเรื่องแล้ว!"}),(0,l.jsx)("div",{className:"text-sm",children:e.message})]})]})},t))})})};function y(){var e,t;let[s,y]=(0,a.useState)([]),[v,w]=(0,a.useState)(null),[A,k]=(0,a.useState)(!0),[C,S]=(0,a.useState)(""),[I,D]=(0,a.useState)(null),[E,P]=(0,a.useState)(new Set),[_,q]=(0,a.useState)(null),M=(0,n.useRouter)(),F=(0,n.useSearchParams)(),[O,H]=(0,a.useState)({show:!1,order:null,type:"completed"}),[T,B]=(0,a.useState)(null),[L,U]=(0,a.useState)(null),[z,J]=(0,a.useState)(!1),R=F.get("restaurantId"),G=F.get("orderId"),Q=F.get("table");(0,a.useEffect)(()=>{let e=F.get("userId")||localStorage.getItem("userId");if(e&&q(e),!R){S("ข้อมูลร้านอาหารไม่ถูกต้อง"),k(!1);return}(async()=>{try{let e=await (0,b.GG)((0,b.P)((0,b.rJ)(p.db,"users"),(0,b._M)("__name__","==",R)));e.empty||D(e.docs[0].data())}catch(e){console.error("Error fetching restaurant info:",e)}})(),(async()=>{let t=Q;if(G&&!t)try{(0,b.H9)(p.db,"users",R,"orders",G);let e=await (0,b.GG)((0,b.P)((0,b.rJ)(p.db,"users",R,"orders"),(0,b._M)("__name__","==",G)));e.empty||(t=e.docs[0].data().table)}catch(e){console.error("Error fetching order for table:",e)}if(!e&&!t){S("ไม่พบข้อมูลผู้ใช้หรือโต๊ะ"),k(!1);return}let s=e?(0,b.P)((0,b.rJ)(p.db,"users",R,"orders"),(0,b._M)("userId","==",e)):(0,b.P)((0,b.rJ)(p.db,"users",R,"orders"),(0,b._M)("table","==",t));return(0,b.aQ)(s,e=>{let t=[],s=null;if(e.forEach(e=>{let l=e.data(),a={id:e.id,...l};t.push(a),G&&e.id===G&&(s=a)}),t.sort((e,t)=>{var s,l;let a=(null==(s=e.createdAt)?void 0:s.toDate)?e.createdAt.toDate().getTime():0;return((null==(l=t.createdAt)?void 0:l.toDate)?t.createdAt.toDate().getTime():0)-a}),y(t),s||t.length>0&&!s){let e=s||t[0];if(T&&T!==e.status){let t="",s="";switch(e.status){case"cooking":t="\uD83D\uDC68‍\uD83C\uDF73 เริ่มปรุงอาหารแล้ว!",s="ออเดอร์ของคุณกำลังถูกเตรียม".concat(e.queueNumber?" (คิวที่ ".concat(e.queueNumber,")"):"");break;case"served":t="\uD83C\uDF7D️ อาหารพร้อมเสิร์ฟ!",s="อาหารของคุณพร้อมแล้ว กรุณามารับที่เคาน์เตอร์";break;case"completed":t="✅ เสร็จสิ้น!",s="ขอบคุณที่ใช้บริการ".concat(e.pointsEarned?" คุณได้รับ ".concat(e.pointsEarned," แต้ม"):"");break;case"cancelled":t="❌ ออเดอร์ถูกยกเลิก",s="ออเดอร์ของคุณถูกยกเลิก กรุณาติดต่อพนักงาน"}t&&j(t,s)}if("cooking"===e.status&&e.queueNumber){let t=e.queueNumber;L&&L!==t&&(t<=3&&L>3?j("⏰ เกือบถึงคิวแล้ว!","คุณอยู่ในคิวที่ ".concat(t," อาหารจะเสร็จเร็วๆ นี้")):1===t&&j("\uD83D\uDD25 ถึงคิวแล้ว!","คุณอยู่ในคิวแรก อาหารกำลังจะเสร็จแล้ว!")),U(t)}B(e.status)}if(s)w(s),P(new Set([s.id]));else if(t.length>0){let e=t[0];w(e),P(new Set([e.id]))}k(!1)},e=>{console.error("Error listening to orders:",e),S("เกิดข้อผิดพลาดในการโหลดข้อมูล"),k(!1)})})()},[R,G,Q,_]),(0,a.useEffect)(()=>{s.forEach(e=>{if(("completed"===e.status||"cancelled"===e.status)&&!O.show){var t;let s=sessionStorage.getItem("order-".concat(e.id,"-dismissed")),l=(null==(t=e.updatedAt)?void 0:t.toDate)?e.updatedAt.toDate().getTime():0,a=sessionStorage.getItem("session-start-time");a||sessionStorage.setItem("session-start-time",Date.now().toString());let n=Number.parseInt(a||Date.now().toString());!s&&n-l<3e4&&H({show:!0,order:e,type:e.status})}})},[s,O.show]),(0,a.useEffect)(()=>{(async()=>{J(await f())})()},[]);let V=e=>{switch(e){case"pending":return{title:"รอการยืนยัน",description:"ร้านค้ากำลังตรวจสอบออเดอร์ของคุณ",color:"yellow",bgColor:"bg-yellow-50",iconBg:"bg-yellow-100",iconColor:"text-yellow-600",badgeColor:"bg-yellow-100 text-yellow-800",icon:(0,l.jsx)(r.A,{className:"h-8 w-8"})};case"cooking":return{title:"กำลังเตรียมอาหาร",description:"ร้านค้ากำลังปรุงอาหารให้คุณ",color:"orange",bgColor:"bg-orange-50",iconBg:"bg-orange-100",iconColor:"text-orange-600",badgeColor:"bg-orange-100 text-orange-800",icon:(0,l.jsx)(i.A,{className:"h-8 w-8"})};case"served":return{title:"เสิร์ฟแล้ว",description:"อาหารของคุณพร้อมเสิร์ฟแล้ว",color:"green",bgColor:"bg-green-50",iconBg:"bg-green-100",iconColor:"text-green-600",badgeColor:"bg-green-100 text-green-800",icon:(0,l.jsx)(c.A,{className:"h-8 w-8"})};case"completed":return{title:"เสร็จสิ้น",description:"ขอบคุณที่ใช้บริการ",color:"green",bgColor:"bg-green-50",iconBg:"bg-green-100",iconColor:"text-green-600",badgeColor:"bg-green-100 text-green-800",icon:(0,l.jsx)(c.A,{className:"h-8 w-8"})};case"cancelled":return{title:"ยกเลิกแล้ว",description:"ออเดอร์นี้ถูกยกเลิก",color:"red",bgColor:"bg-red-50",iconBg:"bg-red-100",iconColor:"text-red-600",badgeColor:"bg-red-100 text-red-800",icon:(0,l.jsx)(o.A,{className:"h-8 w-8"})};default:return{title:"ไม่ทราบสถานะ",description:"",color:"gray",bgColor:"bg-gray-50",iconBg:"bg-gray-100",iconColor:"text-gray-600",badgeColor:"bg-gray-100 text-gray-800",icon:(0,l.jsx)(r.A,{className:"h-8 w-8"})}}},W=e=>{var t,s,l;let a=(null==(t=e.createdAt)?void 0:t.toDate)?e.createdAt.toDate():new Date,n=(null==I?void 0:I.storeName)||(null==I?void 0:I.restaurantName)||"ร้านอาหาร",r="\n=================================\n".concat(n,"\n=================================\nวันที่: ").concat(a.toLocaleDateString("th-TH",{year:"numeric",month:"2-digit",day:"2-digit"}),"\nเวลา: ").concat(a.toLocaleTimeString("th-TH",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),"\nโต๊ะ: ").concat(e.table,"\nออเดอร์: #").concat(e.id.slice(-6).toUpperCase(),"\n").concat(_?"ลูกค้า: ".concat(_.slice(-6).toUpperCase()):"","\n").concat(e.memberId?"สมาชิก: ".concat(e.memberPhone||"ไม่ระบุ"):"","\n=================================\n\nรายการอาหาร:\n");return null==(s=e.items)||s.forEach((e,t)=>{var s;let l=(e.price+((null==(s=e.selectedOptions)?void 0:s.reduce((e,t)=>e+t.price,0))||0))*e.quantity;r+="".concat(t+1,". ").concat(e.name," x").concat(e.quantity,"\n"),r+="   ฿".concat(e.price.toFixed(2)),e.selectedOptions&&e.selectedOptions.length>0&&(r+="\n   ตัวเลือก: ".concat(e.selectedOptions.map(e=>"".concat(e.name," (+฿").concat(e.price,")")).join(", "))),e.specialInstructions&&(r+="\n   หมายเหตุ: ".concat(e.specialInstructions)),r+="\n   รวม: ฿".concat(l.toFixed(2),"\n\n")}),r+="=================================",e.originalAmount&&e.originalAmount!==e.totalAmount&&(r+="\nราคาเดิม: ฿".concat(e.originalAmount.toFixed(2)),e.appliedPromotion&&(r+="\nโปรโมชั่น: ".concat(e.appliedPromotion.title),"discount"===e.appliedPromotion.type&&(r+=" (ลด ".concat(e.appliedPromotion.value,"%)")))),r+="\nยอดรวมทั้งสิ้น: ฿".concat((null==(l=e.totalAmount)?void 0:l.toFixed(2))||"0.00"),e.memberId&&e.pointsEarned&&"completed"===e.status&&(r+="\n=================================",r+="\nแต้มที่ได้รับ: ".concat(e.pointsEarned," แต้ม")),r+="\n=================================\n\nขอบคุณที่ใช้บริการ\n"},X=e=>{let t=new Blob(["\uFEFF"+W(e)],{type:"text/plain;charset=utf-8"}),s=URL.createObjectURL(t),l=document.createElement("a");l.href=s,l.download="receipt-".concat(e.id.slice(-6),"-").concat(_?_.slice(-6):"guest",".txt"),document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(s)},Z=()=>{if(R){var e;let t=Q||(null==(e=s[0])?void 0:e.table)||"1";M.push("/order?id=".concat(R,"&table=").concat(t))}},K=e=>{let t=new Set(E);t.has(e)?t.delete(e):t.add(e),P(t)},Y=e=>{w(e),P(new Set([e.id]))};return A?(0,l.jsx)("div",{className:"min-h-screen bg-blue-400 flex items-center justify-center",children:(0,l.jsxs)("div",{className:"text-center text-white",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-white mx-auto mb-4"}),(0,l.jsx)("h2",{className:"text-2xl font-bold",children:"กำลังโหลดสถานะ..."})]})}):C?(0,l.jsx)("div",{className:"min-h-screen bg-blue-400 flex items-center justify-center p-4",children:(0,l.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-8 text-center max-w-md w-full",children:[(0,l.jsx)("div",{className:"text-red-500 mb-6",children:(0,l.jsx)(o.A,{className:"h-16 w-16 mx-auto"})}),(0,l.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"เกิดข้อผิดพลาด"}),(0,l.jsx)("p",{className:"text-gray-600 mb-6",children:C}),(0,l.jsx)("button",{onClick:Z,className:"px-6 py-3 bg-blue-400 text-white rounded-xl font-bold hover:bg-blue-500",children:"กลับไปสั่งอาหาร"})]})}):0===s.length?(0,l.jsx)("div",{className:"min-h-screen bg-blue-400 flex items-center justify-center p-4",children:(0,l.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-8 text-center max-w-md w-full",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"ไม่พบออเดอร์"}),(0,l.jsx)("p",{className:"text-gray-600 mb-6",children:"ไม่พบออเดอร์สำหรับโต๊ะนี้"}),(0,l.jsx)("button",{onClick:Z,className:"px-6 py-3 bg-blue-400 text-white rounded-xl font-bold hover:bg-blue-500",children:"สั่งอาหาร"})]})}):(0,l.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,l.jsx)(N,{tableNumber:Q||(null==(e=s[0])?void 0:e.table)||"1"}),(0,l.jsx)("div",{className:"bg-blue-400 text-white shadow-lg",children:(0,l.jsx)("div",{className:"max-w-md mx-auto px-4 py-4",children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("button",{onClick:Z,className:"mr-3 p-2 rounded-full hover:bg-blue-500",children:(0,l.jsx)(d.A,{className:"h-6 w-6"})}),z&&(0,l.jsx)("div",{className:"mr-2 px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full flex items-center",children:"\uD83D\uDD14 แจ้งเตือนเปิด"}),!z&&(0,l.jsx)("button",{onClick:async()=>{J(await f())},className:"mr-2 px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full hover:bg-yellow-200",children:"\uD83D\uDD15 เปิดแจ้งเตือน"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-xl font-bold",children:"สถานะออเดอร์"}),(0,l.jsx)("p",{className:"text-blue-100",children:_?"ออเดอร์ของคุณ • ".concat(s.filter(e=>"completed"!==e.status&&"cancelled"!==e.status).length," ออเดอร์"):"โต๊ะ ".concat(null==(t=s[0])?void 0:t.table," • ").concat(s.filter(e=>"completed"!==e.status&&"cancelled"!==e.status).length," ออเดอร์")})]})]})})}),(0,l.jsxs)("div",{className:"max-w-md mx-auto p-4",children:[v&&(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsx)("h2",{className:"text-lg font-bold text-gray-800 mb-3",children:"ออเดอร์ปัจจุบัน"}),(0,l.jsx)("div",{className:"bg-white rounded-2xl shadow-xl overflow-hidden border-2 border-blue-200",children:(()=>{var e;let t=V(v.status);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"p-6 text-center ".concat(t.bgColor),children:[(0,l.jsx)("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full mb-4 ".concat(t.iconBg," ").concat(t.iconColor),children:t.icon}),(0,l.jsx)("h3",{className:"text-xl font-bold text-gray-800 mb-2",children:t.title}),(0,l.jsx)("p",{className:"text-gray-600",children:t.description}),"cooking"===v.status&&v.queueNumber&&(0,l.jsxs)("div",{className:"mt-4 p-3 bg-white rounded-xl border-2 border-blue-200 shadow-lg",children:[(0,l.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"ออเดอร์นี้อยู่ในคิว"}),(0,l.jsx)("div",{className:"flex items-center justify-center",children:(0,l.jsxs)("p",{className:"text-2xl font-bold text-blue-600",children:["#",v.queueNumber]})})]}),v.memberId&&v.pointsEarned&&(0,l.jsxs)("div",{className:"mt-4 p-3 bg-white rounded-xl border-2 border-green-200 shadow-lg",children:[(0,l.jsxs)("div",{className:"flex items-center justify-center mb-2",children:[(0,l.jsx)(m.A,{className:"h-4 w-4 text-green-600 mr-2"}),(0,l.jsx)("span",{className:"text-sm font-medium text-green-600",children:"สมาชิก"})]}),(0,l.jsxs)("div",{className:"flex items-center justify-center",children:[(0,l.jsx)(x.A,{className:"h-4 w-4 text-blue-600 mr-2"}),(0,l.jsx)("span",{className:"text-sm text-gray-600",children:"completed"===v.status?"ได้รับ ".concat(v.pointsEarned," แต้ม"):"จะได้รับ ".concat(v.pointsEarned," แต้ม")})]})]})]}),(0,l.jsx)("div",{className:"p-4 bg-gray-50",children:(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsxs)("span",{className:"text-sm text-gray-600",children:["ออเดอร์ #",v.id.slice(-6).toUpperCase()]}),(0,l.jsxs)("div",{className:"text-right",children:[(0,l.jsxs)("div",{className:"text-lg font-bold text-blue-600",children:["฿",(null==(e=v.totalAmount)?void 0:e.toFixed(2))||"0.00"]}),v.originalAmount&&v.originalAmount!==v.totalAmount&&(0,l.jsxs)("div",{className:"text-xs text-gray-500 line-through",children:["฿",v.originalAmount.toFixed(2)]}),v.appliedPromotion&&(0,l.jsx)("div",{className:"text-xs text-purple-600",children:v.appliedPromotion.title})]})]})})]})})()})]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("h2",{className:"text-lg font-bold text-gray-800",children:["ออเดอร์ที่กำลังดำเนินการ (",s.filter(e=>"completed"!==e.status&&"cancelled"!==e.status).length,")"]}),s.filter(e=>"completed"!==e.status&&"cancelled"!==e.status).map(e=>{var t,s,a,n,r;let i=V(e.status),o=E.has(e.id),d=(null==v?void 0:v.id)===e.id;return(0,l.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden ".concat(d?"border-2 border-blue-300":"border border-gray-200"),children:[(0,l.jsx)("div",{className:"p-4 cursor-pointer hover:bg-gray-50",onClick:()=>K(e.id),children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("div",{className:"w-3 h-3 rounded-full mr-3 ".concat("pending"===e.status?"bg-yellow-500":"cooking"===e.status?"bg-orange-500":"served"===e.status?"bg-blue-500":"completed"===e.status?"bg-green-500":"bg-red-500")}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsxs)("span",{className:"font-bold text-gray-800",children:["#",e.id.slice(-6).toUpperCase()]}),d&&(0,l.jsx)("span",{className:"ml-2 px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:"ปัจจุบัน"}),e.memberId&&(0,l.jsxs)("span",{className:"ml-2 px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full flex items-center",children:[(0,l.jsx)(m.A,{className:"h-3 w-3 mr-1"}),"สมาชิก"]})]}),(0,l.jsxs)("div",{className:"flex items-center mt-1",children:[(0,l.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(i.badgeColor),children:i.title}),"cooking"===e.status&&e.queueNumber&&(0,l.jsxs)("span",{className:"ml-2 px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:["คิว #",e.queueNumber]})]})]})]}),(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsxs)("div",{className:"text-right mr-3",children:[(0,l.jsxs)("div",{className:"font-bold text-blue-600",children:["฿",(null==(t=e.totalAmount)?void 0:t.toFixed(2))||"0.00"]}),e.originalAmount&&e.originalAmount!==e.totalAmount&&(0,l.jsxs)("div",{className:"text-xs text-gray-500 line-through",children:["฿",e.originalAmount.toFixed(2)]}),(0,l.jsx)("div",{className:"text-xs text-gray-500",children:(null==(s=e.createdAt)?void 0:s.toDate)?new Date(e.createdAt.toDate()).toLocaleTimeString("th-TH",{hour:"2-digit",minute:"2-digit"}):"-"})]}),o?(0,l.jsx)(u,{className:"h-5 w-5 text-gray-400"}):(0,l.jsx)(h.A,{className:"h-5 w-5 text-gray-400"})]})]})}),o&&(0,l.jsxs)("div",{className:"border-t border-gray-200",children:[(0,l.jsxs)("div",{className:"p-4",children:[(0,l.jsxs)("div",{className:"space-y-3 mb-4",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-xl",children:[(0,l.jsx)("span",{className:"text-gray-600 font-medium",children:"เวลาสั่ง"}),(0,l.jsx)("span",{className:"font-bold",children:(null==(a=e.createdAt)?void 0:a.toDate)?new Date(e.createdAt.toDate()).toLocaleString("th-TH",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-"})]}),(0,l.jsxs)("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-xl",children:[(0,l.jsx)("span",{className:"text-gray-600 font-medium",children:"จำนวนรายการ"}),(0,l.jsxs)("span",{className:"font-bold",children:[(null==(n=e.items)?void 0:n.length)||0," รายการ"]})]}),e.memberId&&e.pointsEarned&&(0,l.jsxs)("div",{className:"flex justify-between items-center p-3 bg-green-50 rounded-xl",children:[(0,l.jsxs)("span",{className:"text-green-600 font-medium flex items-center",children:[(0,l.jsx)(x.A,{className:"h-4 w-4 mr-1"}),"แต้มที่จะได้รับ"]}),(0,l.jsxs)("span",{className:"font-bold text-green-600",children:[e.pointsEarned," แต้ม"]})]})]}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("h4",{className:"font-bold text-lg mb-3",children:"รายการอาหาร"}),(0,l.jsx)("div",{className:"space-y-2",children:null==(r=e.items)?void 0:r.map((e,t)=>{var s;return(0,l.jsxs)("div",{className:"flex justify-between items-start p-3 bg-gray-50 rounded-xl",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("span",{className:"font-bold",children:e.name}),(0,l.jsxs)("span",{className:"text-blue-600 font-bold ml-2",children:["x",e.quantity]}),e.selectedOptions&&e.selectedOptions.length>0&&(0,l.jsxs)("div",{className:"text-sm text-gray-600 mt-1",children:["(",e.selectedOptions.map(e=>e.name).join(", "),")"]}),e.specialInstructions&&(0,l.jsxs)("div",{className:"text-sm text-gray-600 italic mt-1",children:['"',e.specialInstructions,'"']})]}),(0,l.jsxs)("span",{className:"font-bold text-blue-600",children:["฿",((e.price+((null==(s=e.selectedOptions)?void 0:s.reduce((e,t)=>e+t.price,0))||0))*e.quantity).toFixed(2)]})]},t)})})]}),e.appliedPromotion&&(0,l.jsxs)("div",{className:"mb-4 p-3 bg-purple-50 rounded-xl border border-purple-200",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(x.A,{className:"h-4 w-4 text-purple-600 mr-2"}),(0,l.jsxs)("span",{className:"font-medium text-purple-800",children:["โปรโมชั่น: ",e.appliedPromotion.title]})]}),"discount"===e.appliedPromotion.type&&(0,l.jsxs)("div",{className:"text-sm text-purple-600 mt-1",children:["ลด ",e.appliedPromotion.value,"%"]}),"points_multiplier"===e.appliedPromotion.type&&(0,l.jsxs)("div",{className:"text-sm text-purple-600 mt-1",children:["แต้มคูณ ",e.appliedPromotion.value]})]}),(0,l.jsxs)("div",{className:"flex gap-2",children:[!d&&(0,l.jsx)("button",{onClick:()=>Y(e),className:"flex-1 px-4 py-3 bg-blue-400 text-white rounded-xl font-bold hover:bg-blue-500 transition-colors",children:"ตั้งเป็นออเดอร์ปัจจุบัน"}),"completed"===e.status&&(0,l.jsxs)("button",{onClick:()=>X(e),className:"flex-1 flex items-center justify-center px-4 py-3 bg-green-600 text-white rounded-xl font-bold hover:bg-green-700 transition-colors",children:[(0,l.jsx)(g.A,{className:"h-4 w-4 mr-2"}),"ดาวน์โหลดใบเสร็จ"]})]})]}),(0,l.jsxs)("div",{className:"bg-gray-50 p-4",children:[(0,l.jsx)("h4",{className:"font-bold text-sm mb-4",children:"ขั้นตอนการเตรียมอาหาร"}),(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)("div",{className:"flex items-center ".concat(["pending","cooking","served","completed"].includes(e.status)?"text-green-600":"text-gray-400"),children:[(0,l.jsx)("div",{className:"w-4 h-4 rounded-full mr-3 flex items-center justify-center ".concat(["pending","cooking","served","completed"].includes(e.status)?"bg-green-500":"bg-gray-300"),children:(0,l.jsx)(c.A,{className:"h-3 w-3 text-white"})}),(0,l.jsx)("span",{className:"text-sm font-medium",children:"ได้รับออเดอร์"})]}),(0,l.jsxs)("div",{className:"flex items-center ".concat(["cooking","served","completed"].includes(e.status)?"text-green-600":"text-gray-400"),children:[(0,l.jsx)("div",{className:"w-4 h-4 rounded-full mr-3 flex items-center justify-center ".concat(["cooking","served","completed"].includes(e.status)?"bg-green-500":"bg-gray-300"),children:(0,l.jsx)(c.A,{className:"h-3 w-3 text-white"})}),(0,l.jsx)("span",{className:"text-sm font-medium",children:"ยืนยันออเดอร์"})]}),(0,l.jsxs)("div",{className:"flex items-center ".concat(["served","completed"].includes(e.status)?"text-green-600":"text-gray-400"),children:[(0,l.jsx)("div",{className:"w-4 h-4 rounded-full mr-3 flex items-center justify-center ".concat(["served","completed"].includes(e.status)?"bg-green-500":"bg-gray-300"),children:(0,l.jsx)(c.A,{className:"h-3 w-3 text-white"})}),(0,l.jsx)("span",{className:"text-sm font-medium",children:"เตรียมอาหารเสร็จ"})]}),(0,l.jsxs)("div",{className:"flex items-center ".concat("completed"===e.status?"text-green-600":"text-gray-400"),children:[(0,l.jsx)("div",{className:"w-4 h-4 rounded-full mr-3 flex items-center justify-center ".concat("completed"===e.status?"bg-green-500":"bg-gray-300"),children:(0,l.jsx)(c.A,{className:"h-3 w-3 text-white"})}),(0,l.jsx)("span",{className:"text-sm font-medium",children:"เสร็จสิ้น"})]})]})]})]})]},e.id)})]}),O.show&&O.order&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,l.jsxs)("div",{className:"bg-white rounded-2xl max-w-md w-full p-6 text-center",children:[(0,l.jsx)("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center ".concat("completed"===O.type?"bg-green-100":"bg-red-100"),children:"completed"===O.type?(0,l.jsx)(c.A,{className:"h-8 w-8 text-green-600"}):(0,l.jsx)(o.A,{className:"h-8 w-8 text-red-600"})}),(0,l.jsx)("h3",{className:"text-xl font-bold mb-2",children:"completed"===O.type?"ออเดอร์เสร็จสิ้น!":"ออเดอร์ถูกยกเลิก"}),(0,l.jsx)("p",{className:"text-gray-600 mb-4",children:"completed"===O.type?"ขอบคุณที่ใช้บริการ คุณสามารถดาวน์โหลดใบเสร็จได้":"ออเดอร์ของคุณถูกยกเลิกแล้ว"}),"completed"===O.type&&O.order.memberId&&O.order.pointsEarned&&(0,l.jsx)("div",{className:"mb-4 p-3 bg-green-50 rounded-lg border border-green-200",children:(0,l.jsxs)("div",{className:"flex items-center justify-center",children:[(0,l.jsx)(x.A,{className:"h-5 w-5 text-green-600 mr-2"}),(0,l.jsxs)("span",{className:"font-medium text-green-800",children:["คุณได้รับ ",O.order.pointsEarned," แต้ม!"]})]})}),(0,l.jsxs)("div",{className:"space-y-3",children:["completed"===O.type&&(0,l.jsxs)("button",{onClick:()=>{X(O.order),sessionStorage.setItem("order-".concat(O.order.id,"-dismissed"),"true"),H({show:!1,order:null,type:"completed"})},className:"w-full flex items-center justify-center px-4 py-3 bg-green-600 text-white rounded-xl font-bold hover:bg-green-700 transition-colors",children:[(0,l.jsx)(g.A,{className:"h-4 w-4 mr-2"}),"ดาวน์โหลดใบเสร็จ"]}),(0,l.jsx)("button",{onClick:()=>{O.order&&sessionStorage.setItem("order-".concat(O.order.id,"-dismissed"),"true"),H({show:!1,order:null,type:"completed"})},className:"w-full px-4 py-3 bg-gray-200 text-gray-800 rounded-xl font-bold hover:bg-gray-300 transition-colors",children:"ปิด"}),(0,l.jsx)("button",{onClick:()=>{O.order&&sessionStorage.setItem("order-".concat(O.order.id,"-dismissed"),"true"),Z()},className:"w-full px-4 py-3 bg-blue-400 text-white rounded-xl font-bold hover:bg-blue-500 transition-colors",children:"สั่งอาหารเพิ่ม"})]})]})}),(0,l.jsx)("div",{className:"mt-6 text-center",children:(0,l.jsx)("p",{className:"text-sm text-gray-500 bg-white rounded-xl p-3",children:"\uD83D\uDCF1 หน้านี้จะอัปเดตสถานะอัตโนมัติ"})}),(0,l.jsx)("div",{className:"mt-6",children:(0,l.jsx)("button",{onClick:Z,className:"w-full px-6 py-4 bg-blue-400 text-white rounded-xl font-bold hover:bg-blue-500 transition-colors",children:"สั่งอาหารเพิ่ม"})})]})]})}function v(){let e=(0,n.useRouter)(),t=(0,n.useSearchParams)(),s=t.get("restaurantId"),r=t.get("orderId");return(t.get("table"),(0,a.useEffect)(()=>{s&&r||e.push("/")},[s,r,e]),s&&r)?(0,l.jsx)(y,{}):(0,l.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,l.jsxs)("div",{className:"text-center p-6",children:[(0,l.jsx)("h1",{className:"text-2xl font-bold mb-2",children:"ไม่พบข้อมูลออเดอร์"}),(0,l.jsx)("p",{className:"text-gray-600 mb-4",children:"กรุณาสแกน QR Code ใหม่อีกครั้ง"})]})})}},7550:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});let l=(0,s(9946).A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},7970:(e,t,s)=>{Promise.resolve().then(s.bind(s,6652))}},e=>{var t=t=>e(e.s=t);e.O(0,[992,122,234,955,441,684,358],()=>t(7970)),_N_E=e.O()}]);